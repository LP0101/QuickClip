<html>
  <head>
    <meta charset="UTF-8">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
    <title>QuickClip</title>
  </head>
  <body>
    <div class="header">
        <h1><a class="link" href="/">QuickClip</a></h1>
    </div>
      <div class="video">
        <video id="video" class="video" src="/files/{{filename}}" controls="controls" preload="preload" autoplay="autoplay" width="1280px" height="720px" />
        </div>
  </body>
  <script>
const sleep = ms => new Promise(res => setTimeout(res, ms));
let video = document.getElementById('video');
document.addEventListener("DOMContentLoaded", async function () {
    console.log("In here!")
    let waiting = false;
    response = await fetch(window.location.origin+'/status/{{filename}}');
    status = response.status;
    console.log(status)
    while(status == 420) {
      video.style.display = 'none'
      waiting = true;
      console.log(waiting)
      await sleep(500);
      response = await fetch(window.location.origin+'/status/{{filename}}');
      status = response.status;
    }
    if (waiting) {
      video.style.display = 'block'
      video.load();
      video.play();
    }
})
  </script>
</html>