<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <link rel=stylesheet type=text/css href="{{ url_for('static', filename='style.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <title>QuickClip</title>
    <meta property="og:title" value="QuickClip" />
    <meta property="og:type" value="video" />
    <meta property="og:description" value="The easy video sharing solution" />
    {% if external_url is not none %}
    <meta property="og:video" value="{{external_url}}/files/{{filename}}" />
    {% endif %}
  </head>
  <body>
    <div class="header">
        <h1><a class="link" href="/">QuickClip</a></h1>
    </div>
      <div class="video-container">
        <div class="messages">
        <div id="loader" class="loader"></div>
        <span id="message" class="centered">Processing</span>
      </div>
        <video id="video" src="/files/{{filename}}" controls="controls" preload="auto" autoplay="autoplay" width="100%" height="720px" style="display: none;"/>
      </div>
  </body>
  <script>
const sleep = ms => new Promise(res => setTimeout(res, ms));
let video = document.getElementById('video');
let message = document.getElementById('message');
let loader = document.getElementById('loader');

document.addEventListener("DOMContentLoaded", async function () {
    response = await fetch('/status/{{filename}}');
    status = response.status;
    console.log(status)
    if (status == 404){
      loader.style.display = 'none';
      message.style.display = 'block';
      message.innerHTML = 'Video not found';
    }
    while(status == 420) {
      await sleep(500);
      response = await fetch('/status/{{filename}}');
      status = response.status;
    }
    if (status == 200) {
      message.style.display = 'none';
      video.style.display = 'block';
      loader.style.display = 'none';
      video.load();
      video.play();
    }
})
  </script>
</html>
